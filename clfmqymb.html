<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>区域客户策略分类表</title>
  <!-- 引入外部资源 -->
  <script src="https://cdn.tailwindcss.com"></script>
  <link href="https://cdn.jsdelivr.net/npm/font-awesome@4.7.0/css/font-awesome.min.css" rel="stylesheet">
  
  <!-- Tailwind 配置 -->
  <script>
    tailwind.config = {
      theme: {
        extend: {
          colors: {
            primary: '#1e40af',
            secondary: '#3b82f6',
            accent: '#60a5fa',
            neutral: '#f1f5f9',
            'neutral-dark': '#334155',
            danger: '#dc2626',
            success: '#16a34a',
          },
          fontFamily: {
            sans: ['Inter', 'system-ui', 'sans-serif'],
          },
        },
      }
    }
  </script>
  
  <style type="text/tailwindcss">
    @layer utilities {
      .content-auto {
        content-visibility: auto;
      }
      .table-shadow {
        box-shadow: 0 4px 20px rgba(0, 0, 0, 0.08);
      }
      .cell-hover {
        @apply transition-all duration-200 hover:bg-blue-50;
      }
      .editable-cell {
        @apply focus:ring-2 focus:ring-blue-500 focus:outline-none transition-all duration-200;
      }
      .fixed-header {
        @apply bg-primary text-white font-semibold;
      }
      .merged-cell {
        @apply bg-neutral text-neutral-dark font-semibold;
      }
      /* 固定表格列宽，行高自适应 */
      .fixed-table {
        table-layout: fixed;
        width: 100%;
      }
      .table-cell {
        overflow: hidden;
        text-overflow: ellipsis;
        padding: 0.5rem;
      }
      /* 编辑模式输入框样式 */
      .strategy-input {
        width: 100%;
        min-height: 2.5rem;
        box-sizing: border-box;
      }
    }
  </style>
</head>
<body class="bg-gray-50 font-sans text-gray-800 m-0">
  <div class="container px-4 py-6 w-full max-w-none">
    <!-- 页面标题和操作按钮 -->
    <header class="mb-4 flex flex-wrap justify-between items-center">
      <h1 class="text-[clamp(1.2rem,2vw,1.8rem)] font-bold text-primary mb-1 flex items-center">
        <i class="fa fa-sitemap mr-2 text-secondary"></i>客户策略分类表
      </h1>
      <div class="flex gap-3">
        <button id="editTemplateBtn" class="px-4 py-1.5 bg-secondary text-white rounded-md shadow hover:bg-primary transition-all duration-200 flex items-center text-sm">
          <i class="fa fa-pencil mr-1.5"></i>修改信息
        </button>
        <button id="saveTemplateBtn" class="px-4 py-1.5 bg-success text-white rounded-md shadow hover:bg-success/90 transition-all duration-200 flex items-center text-sm hidden">
          <i class="fa fa-save mr-1.5"></i>保存为当前区域模板
        </button>
      </div>
    </header>
    
    <p class="text-gray-600 text-sm mb-4">策略分类表用于指导不同类型客户的市场、商务和交付策略</p>
    
    <!-- 表格容器 -->
    <div class="overflow-x-auto bg-white rounded-lg shadow-md table-shadow transition-all duration-300 hover:shadow-lg">
      <table class="fixed-table divide-y divide-gray-200 text-sm border-collapse" id="strategyTable">
        <thead class="bg-neutral">
          <!-- 第一行固定表头（合并单元格） -->
          <tr>
            <th class="px-3 py-2 text-left text-xs fixed-header uppercase tracking-wider table-cell" style="width: 140px;">策略分类</th>
            <th class="px-3 py-2 text-left text-xs fixed-header uppercase tracking-wider table-cell" style="width: 140px;">细分类别</th>
            <th class="px-3 py-2 text-left text-xs fixed-header uppercase tracking-wider table-cell" colspan="2" style="width: 240px;">市场策略</th>
            <th class="px-3 py-2 text-left text-xs fixed-header uppercase tracking-wider table-cell" style="width: 120px;">商务策略</th>
            <th class="px-3 py-2 text-left text-xs fixed-header uppercase tracking-wider table-cell" style="width: 120px;">交付策略</th>
            <th class="px-3 py-2 text-left text-xs fixed-header uppercase tracking-wider table-cell" colspan="3" style="width: 300px;">客户深度经营策略</th>
          </tr>
          <!-- 第二行固定子表头 -->
          <tr>
            <th class="px-3 py-2 text-left text-xs font-semibold text-neutral-dark uppercase tracking-wider table-cell" colspan="2"></th>
            <th class="px-3 py-2 text-left text-xs font-semibold text-neutral-dark uppercase tracking-wider table-cell" style="width: 120px;">洞察支撑</th>
            <th class="px-3 py-2 text-left text-xs font-semibold text-neutral-dark uppercase tracking-wider table-cell" style="width: 120px;">市场活动</th>
            <th class="px-3 py-2 text-left text-xs font-semibold text-neutral-dark uppercase tracking-wider table-cell" style="width: 120px;">合同账期</th>
            <th class="px-3 py-2 text-left text-xs font-semibold text-neutral-dark uppercase tracking-wider table-cell" style="width: 120px;">资源优先级</th>
            <th class="px-3 py-2 text-left text-xs font-semibold text-neutral-dark uppercase tracking-wider table-cell" style="width: 100px;">客户铁三角</th>
            <th class="px-3 py-2 text-left text-xs font-semibold text-neutral-dark uppercase tracking-wider table-cell" style="width: 100px;">ABP</th>
            <th class="px-3 py-2 text-left text-xs font-semibold text-neutral-dark uppercase tracking-wider table-cell" style="width: 100px;">客户关系提升计划</th>
          </tr>
        </thead>
        <tbody class="bg-white divide-y divide-gray-200" id="strategyTableBody">
          <!-- 表格内容通过JavaScript动态生成 -->
        </tbody>
      </table>
    </div>
    
    <!-- 信息提示 -->
    <div id="notification" class="fixed bottom-5 right-5 px-4 py-2 rounded-md shadow-lg transform translate-y-20 opacity-0 transition-all duration-300 flex items-center text-sm"></div>
  </div>

  <script>
    // 初始策略数据（保持与之前相同的内容）
    const initialStrategyData = [
      {
        category: "战略客户（S）",
        subcategories: [
          {
            name: "新战略客户",
            market: { insight: "新客户洞察模板", activity: "相关市场活动必须邀请" },
            business: "0-90天",
            delivery: "资源优先，但优先级低于战略项目",
            deep: { ironTriangle: "资源优先，但优先级低于战略项目", abp: "X", relationship: "√" }
          },
          {
            name: "目标战略客户",
            market: { insight: "去除战略信息的洞察模板", activity: "相关市场活动必须邀请" },
            business: "0-90天",
            delivery: "资源优先，但优先级低于战略项目",
            deep: { ironTriangle: "资源优先，但优先级低于战略项目", abp: "√", relationship: "√" }
          },
          {
            name: "已成为战略供应商的战略客户",
            market: { insight: "全量洞察模板", activity: "相关市场活动必须邀请" },
            business: "0-90天",
            delivery: "资源优先，但优先级低于战略项目",
            deep: { ironTriangle: "资源优先，但优先级低于战略项目", abp: "√", relationship: "√" }
          }
        ]
      },
      {
        category: "重要客户（A）",
        subcategories: [
          {
            name: "",
            market: { insight: "X", activity: "邀请" },
            business: "0-60天",
            delivery: "X",
            deep: { ironTriangle: "X", abp: "X", relationship: "√" }
          }
        ]
      },
      {
        category: "价值客户（B）",
        subcategories: [
          {
            name: "",
            market: { insight: "X", activity: "可邀请" },
            business: "0-30天",
            delivery: "X",
            deep: { ironTriangle: "X", abp: "X", relationship: "按实际情况选做" }
          }
        ]
      },
      {
        category: "待发展客户（C）",
        subcategories: [
          {
            name: "",
            market: { insight: "X", activity: "X" },
            business: "提高预付款比例，优先款到发货",
            delivery: "X",
            deep: { ironTriangle: "X", abp: "X", relationship: "X" }
          }
        ]
      }
    ];
    
    // 编辑模式状态
    let editMode = false;
    // 当前策略数据
    let strategyData = loadFromLocalStorage() || initialStrategyData;
    
    // 从本地存储加载区域模板数据
    function loadFromLocalStorage() {
      const savedData = localStorage.getItem('regionStrategyTemplate');
      if (savedData) {
        try {
          return JSON.parse(savedData);
        } catch (e) {
          console.error('加载区域策略模板失败', e);
          return null;
        }
      }
      return null;
    }
    
    // 保存数据到本地存储（区域模板）
    function saveToLocalStorage(data) {
      try {
        localStorage.setItem('regionStrategyTemplate', JSON.stringify(data));
        return true;
      } catch (e) {
        console.error('保存区域策略模板失败', e);
        return false;
      }
    }
    
    // 显示通知
    function showNotification(message, isSuccess = true) {
      const notification = document.getElementById('notification');
      notification.textContent = message;
      notification.className = `fixed bottom-5 right-5 px-4 py-2 rounded-md shadow-lg transform translate-y-0 opacity-100 transition-all duration-300 flex items-center text-sm ${
        isSuccess ? 'bg-green-500 text-white' : 'bg-red-500 text-white'
      }`;
      
      setTimeout(() => {
        notification.className = 'fixed bottom-5 right-5 px-4 py-2 rounded-md shadow-lg transform translate-y-20 opacity-0 transition-all duration-300 flex items-center text-sm';
      }, 3000);
    }
    
    // 渲染策略表格（纵向自适应）
    function renderStrategyTable(isEditable = false) {
      const tableBody = document.getElementById('strategyTableBody');
      tableBody.innerHTML = '';
      
      strategyData.forEach((strategyGroup) => {
        const category = strategyGroup.category;
        const subcategories = strategyGroup.subcategories;
        
        subcategories.forEach((sub, subIndex) => {
          // 只在第一个子类别显示策略分类
          const showCategory = subIndex === 0;
          
          const row = document.createElement('tr');
          row.className = 'cell-hover';
          
          // 构建表格单元格（纵向自适应）
          row.innerHTML = `
            <!-- 策略分类 -->
            <td class="border ${showCategory ? 'merged-cell' : ''} table-cell">
              ${showCategory ? category : ''}
            </td>
            
            <!-- 细分类别 -->
            <td class="border table-cell">
              ${sub.name}
            </td>
            
            <!-- 市场策略 - 洞察支撑 -->
            <td class="border table-cell">
              ${isEditable ? 
                `<textarea class="strategy-input px-2 py-1 border rounded text-sm editable-cell" 
                  data-category="${category}" data-sub="${subIndex}" data-field="market.insight">${sub.market.insight}</textarea>` : 
                sub.market.insight
              }
            </td>
            
            <!-- 市场策略 - 市场活动 -->
            <td class="border table-cell">
              ${isEditable ? 
                `<textarea class="strategy-input px-2 py-1 border rounded text-sm editable-cell" 
                  data-category="${category}" data-sub="${subIndex}" data-field="market.activity">${sub.market.activity}</textarea>` : 
                sub.market.activity
              }
            </td>
            
            <!-- 商务策略 - 合同账期 -->
            <td class="border table-cell">
              ${isEditable ? 
                `<textarea class="strategy-input px-2 py-1 border rounded text-sm editable-cell" 
                  data-category="${category}" data-sub="${subIndex}" data-field="business">${sub.business}</textarea>` : 
                sub.business
              }
            </td>
            
            <!-- 交付策略 - 资源优先级 -->
            <td class="border table-cell">
              ${isEditable ? 
                `<textarea class="strategy-input px-2 py-1 border rounded text-sm editable-cell" 
                  data-category="${category}" data-sub="${subIndex}" data-field="delivery">${sub.delivery}</textarea>` : 
                sub.delivery
              }
            </td>
            
            <!-- 客户深度经营策略 - 客户铁三角 -->
            <td class="border table-cell">
              ${isEditable ? 
                `<textarea class="strategy-input px-2 py-1 border rounded text-sm editable-cell" 
                  data-category="${category}" data-sub="${subIndex}" data-field="deep.ironTriangle">${sub.deep.ironTriangle}</textarea>` : 
                sub.deep.ironTriangle
              }
            </td>
            
            <!-- 客户深度经营策略 - ABP -->
            <td class="border table-cell">
              ${isEditable ? 
                `<textarea class="strategy-input px-2 py-1 border rounded text-sm editable-cell" 
                  data-category="${category}" data-sub="${subIndex}" data-field="deep.abp">${sub.deep.abp}</textarea>` : 
                sub.deep.abp
              }
            </td>
            
            <!-- 客户深度经营策略 - 客户关系提升计划 -->
            <td class="border table-cell">
              ${isEditable ? 
                `<textarea class="strategy-input px-2 py-1 border rounded text-sm editable-cell" 
                  data-category="${category}" data-sub="${subIndex}" data-field="deep.relationship">${sub.deep.relationship}</textarea>` : 
                sub.deep.relationship
              }
            </td>
          `;
          
          tableBody.appendChild(row);
        });
      });
      
      // 编辑模式事件监听
      if (isEditable) {
        document.querySelectorAll('.strategy-input').forEach(input => {
          input.addEventListener('change', updateStrategyData);
          // 自动调整文本框高度以适应内容
          input.addEventListener('input', function() {
            this.style.height = 'auto';
            this.style.height = (this.scrollHeight) + 'px';
          });
          // 初始化高度
          input.style.height = (input.scrollHeight) + 'px';
        });
      }
    }
    
    // 更新策略数据
    function updateStrategyData() {
      const category = this.getAttribute('data-category');
      const subIndex = parseInt(this.getAttribute('data-sub'));
      const field = this.getAttribute('data-field');
      const value = this.value;
      
      // 查找对应的策略组和子类别
      const targetGroup = strategyData.find(group => group.category === category);
      if (!targetGroup) return;
      
      const targetSub = targetGroup.subcategories[subIndex];
      if (!targetSub) return;
      
      // 解析字段路径并更新数据
      const fieldParts = field.split('.');
      let target = targetSub;
      
      for (let i = 0; i < fieldParts.length; i++) {
        if (i === fieldParts.length - 1) {
          target[fieldParts[i]] = value;
        } else {
          target = target[fieldParts[i]];
        }
      }
    }
    
    // 切换编辑模式
    function toggleEditMode() {
      editMode = !editMode;
      
      const editBtn = document.getElementById('editTemplateBtn');
      const saveBtn = document.getElementById('saveTemplateBtn');
      
      if (editMode) {
        // 进入编辑模式
        editBtn.classList.add('hidden');
        saveBtn.classList.remove('hidden');
        renderStrategyTable(true);
        showNotification('进入信息编辑模式，可以修改表格内容');
      } else {
        // 退出编辑模式
        editBtn.classList.remove('hidden');
        saveBtn.classList.add('hidden');
        renderStrategyTable(false);
      }
    }
    
    // 保存为当前区域模板
    function saveAsRegionTemplate() {
      if (saveToLocalStorage(strategyData)) {
        toggleEditMode(); // 退出编辑模式
        showNotification('已保存为当前区域模板，下次加载将使用该模板');
      } else {
        showNotification('保存失败，请重试', false);
      }
    }
    
    // 页面加载时初始化
    window.addEventListener('load', () => {
      // 渲染表格
      renderStrategyTable();
      
      // 添加按钮事件监听
      document.getElementById('editTemplateBtn').addEventListener('click', toggleEditMode);
      document.getElementById('saveTemplateBtn').addEventListener('click', saveAsRegionTemplate);
      
      // 添加表格加载动画
      const table = document.querySelector('table');
      table.classList.add('opacity-0', 'transition-opacity', 'duration-500');
      setTimeout(() => {
        table.classList.remove('opacity-0');
      }, 100);
      
      // 提示是否加载了保存的区域模板
      if (loadFromLocalStorage()) {
        showNotification('已加载保存的区域策略模板');
      }
    });
  </script>
</body>
</html>
    